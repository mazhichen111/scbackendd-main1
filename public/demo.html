<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scbackend æ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }

        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .demo-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .code-block {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 10px 0;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .result {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: none;
        }

        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Scbackend æ¼”ç¤º</h1>
        
        <div class="demo-section">
            <h3>1. åˆ›å»ºç¤ºä¾‹é¡¹ç›®</h3>
            <p>è¿™å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ "Hello World" Scratch é¡¹ç›®ï¼š</p>
            <div class="code-block">
{
  "name": "hello_world_demo",
  "body": "{\"targets\":[{\"isStage\":true,\"name\":\"Stage\",\"variables\":{},\"lists\":{},\"broadcasts\":{},\"blocks\":{},\"comments\":{},\"currentCostume\":0,\"costumes\":[{\"name\":\"backdrop1\",\"dataFormat\":\"svg\",\"assetId\":\"cd21514d0531fdffb22204e0ec5ed84a\",\"md5ext\":\"cd21514d0531fdffb22204e0ec5ed84a.svg\",\"rotationCenterX\":240,\"rotationCenterY\":180}],\"sounds\":[],\"volume\":100,\"layerOrder\":0,\"tempo\":60,\"videoTransparency\":50,\"videoState\":\"on\",\"textToSpeechLanguage\":null},{\"isStage\":false,\"name\":\"Sprite1\",\"variables\":{},\"lists\":{},\"broadcasts\":{},\"blocks\":{\"event_whenflagclicked\":{\"opcode\":\"event_whenflagclicked\",\"next\":\"scbackendbasic_log\",\"parent\":null,\"inputs\":{},\"fields\":{},\"shadow\":false,\"topLevel\":true,\"x\":188,\"y\":188},\"scbackendbasic_log\":{\"opcode\":\"scbackendbasic_log\",\"next\":null,\"parent\":\"event_whenflagclicked\",\"inputs\":{\"MESSAGE\":[1,[10,\"Hello from Scratch Backend!\"]]},\"fields\":{},\"shadow\":false,\"topLevel\":false}},\"comments\":{},\"currentCostume\":0,\"costumes\":[{\"name\":\"costume1\",\"dataFormat\":\"svg\",\"assetId\":\"bcf454acf82e4504149f7ffe07081dbc\",\"md5ext\":\"bcf454acf82e4504149f7ffe07081dbc.svg\",\"rotationCenterX\":48,\"rotationCenterY\":50}],\"sounds\":[],\"volume\":100,\"layerOrder\":1,\"visible\":true,\"x\":0,\"y\":0,\"size\":100,\"direction\":90,\"draggable\":false,\"rotationStyle\":\"all around\"}],\"monitors\":[],\"extensions\":[\"scbackendbasic\"],\"meta\":{\"semver\":\"3.0.0\",\"vm\":\"0.2.0\",\"agent\":\"Mozilla/5.0\"}}"
}
            </div>
            <button class="btn" onclick="createDemoProject()">åˆ›å»ºæ¼”ç¤ºé¡¹ç›®</button>
            <div id="create-result" class="result"></div>
            <div id="create-error" class="error"></div>
        </div>

        <div class="demo-section">
            <h3>2. è¿è¡Œé¡¹ç›®</h3>
            <p>å¯åŠ¨åˆšåˆ›å»ºçš„é¡¹ç›®ä½œä¸ºåç«¯æœåŠ¡ï¼š</p>
            <button class="btn" onclick="runDemoProject()">è¿è¡Œæ¼”ç¤ºé¡¹ç›®</button>
            <div id="run-result" class="result"></div>
            <div id="run-error" class="error"></div>
        </div>

        <div class="demo-section">
            <h3>3. è§¦å‘äº‹ä»¶</h3>
            <p>å‘è¿è¡Œä¸­çš„ Scratch é¡¹ç›®å‘é€äº‹ä»¶ï¼š</p>
            <button class="btn" onclick="triggerDemoEvent()">è§¦å‘æ¼”ç¤ºäº‹ä»¶</button>
            <div id="trigger-result" class="result"></div>
            <div id="trigger-error" class="error"></div>
        </div>

        <div class="demo-section">
            <h3>4. æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨</h3>
            <p>è·å–æ‰€æœ‰å·²åˆ›å»ºçš„é¡¹ç›®ï¼š</p>
            <button class="btn" onclick="listProjects()">æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨</button>
            <div id="list-result" class="result"></div>
            <div id="list-error" class="error"></div>
        </div>

        <div class="demo-section">
            <h3>5. æ¸…ç†æ¼”ç¤º</h3>
            <p>åˆ é™¤æ¼”ç¤ºé¡¹ç›®å’Œåœæ­¢ Runnerï¼š</p>
            <button class="btn" onclick="cleanupDemo()">æ¸…ç†æ¼”ç¤º</button>
            <div id="cleanup-result" class="result"></div>
            <div id="cleanup-error" class="error"></div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <a href="/" class="btn">è¿”å›ç®¡ç†é¢æ¿</a>
        </div>
    </div>

    <script>
        const PROJECT_NAME = 'hello_world_demo';

        function showResult(elementId, message, isError = false) {
            const resultElement = document.getElementById(elementId);
            const errorElement = document.getElementById(elementId.replace('result', 'error'));
            
            if (isError) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                resultElement.style.display = 'none';
            } else {
                resultElement.textContent = message;
                resultElement.style.display = 'block';
                errorElement.style.display = 'none';
            }
        }

        async function createDemoProject() {
            try {
                const projectData = {
                    name: PROJECT_NAME,
                    body: '{"targets":[{"isStage":true,"name":"Stage","variables":{},"lists":{},"broadcasts":{},"blocks":{},"comments":{},"currentCostume":0,"costumes":[{"name":"backdrop1","dataFormat":"svg","assetId":"cd21514d0531fdffb22204e0ec5ed84a","md5ext":"cd21514d0531fdffb22204e0ec5ed84a.svg","rotationCenterX":240,"rotationCenterY":180}],"sounds":[],"volume":100,"layerOrder":0,"tempo":60,"videoTransparency":50,"videoState":"on","textToSpeechLanguage":null},{"isStage":false,"name":"Sprite1","variables":{},"lists":{},"broadcasts":{},"blocks":{"event_whenflagclicked":{"opcode":"event_whenflagclicked","next":"scbackendbasic_log","parent":null,"inputs":{},"fields":{},"shadow":false,"topLevel":true,"x":188,"y":188},"scbackendbasic_log":{"opcode":"scbackendbasic_log","next":null,"parent":"event_whenflagclicked","inputs":{"MESSAGE":[1,[10,"Hello from Scratch Backend!"]]},"fields":{},"shadow":false,"topLevel":false}},"comments":{},"currentCostume":0,"costumes":[{"name":"costume1","dataFormat":"svg","assetId":"bcf454acf82e4504149f7ffe07081dbc","md5ext":"bcf454acf82e4504149f7ffe07081dbc.svg","rotationCenterX":48,"rotationCenterY":50}],"sounds":[],"volume":100,"layerOrder":1,"visible":true,"x":0,"y":0,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around"}],"monitors":[],"extensions":["scbackendbasic"],"meta":{"semver":"3.0.0","vm":"0.2.0","agent":"Mozilla/5.0"}}'
                };

                const response = await fetch('/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(projectData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showResult('create-result', `âœ… é¡¹ç›® "${PROJECT_NAME}" åˆ›å»ºæˆåŠŸï¼`);
                } else {
                    const error = await response.json();
                    showResult('create-result', `âŒ åˆ›å»ºå¤±è´¥: ${error.error}`, true);
                }
            } catch (error) {
                showResult('create-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, true);
            }
        }

        async function runDemoProject() {
            try {
                const response = await fetch(`/runner/add/${PROJECT_NAME}`);
                
                if (response.ok) {
                    const result = await response.json();
                    showResult('run-result', `âœ… é¡¹ç›® "${PROJECT_NAME}" å¼€å§‹è¿è¡Œï¼Runner å·²å¯åŠ¨ã€‚`);
                } else {
                    const error = await response.json();
                    showResult('run-result', `âŒ è¿è¡Œå¤±è´¥: ${error.error}`, true);
                }
            } catch (error) {
                showResult('run-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, true);
            }
        }

        async function triggerDemoEvent() {
            try {
                const eventData = {
                    event: 'demo_event',
                    data: {
                        message: 'Hello from Demo UI!',
                        timestamp: new Date().toISOString()
                    }
                };

                const response = await fetch(`/runner/${PROJECT_NAME}/trigger`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(eventData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showResult('trigger-result', `âœ… äº‹ä»¶å·²å‘é€åˆ°é¡¹ç›® "${PROJECT_NAME}"ï¼`);
                } else {
                    const error = await response.json();
                    showResult('trigger-result', `âŒ è§¦å‘å¤±è´¥: ${error.error}`, true);
                }
            } catch (error) {
                showResult('trigger-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, true);
            }
        }

        async function listProjects() {
            try {
                const response = await fetch('/api/projects');
                
                if (response.ok) {
                    const projects = await response.json();
                    const projectList = projects.map(p => `â€¢ ${p.name}`).join('\n');
                    showResult('list-result', `âœ… æ‰¾åˆ° ${projects.length} ä¸ªé¡¹ç›®:\n${projectList}`);
                } else {
                    const error = await response.json();
                    showResult('list-result', `âŒ è·å–å¤±è´¥: ${error.error}`, true);
                }
            } catch (error) {
                showResult('list-result', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, true);
            }
        }

        async function cleanupDemo() {
            try {
                // åœæ­¢ Runner
                const runnerResponse = await fetch(`/runner/remove/${PROJECT_NAME}`);
                
                // åˆ é™¤é¡¹ç›®
                const projectResponse = await fetch(`/project/${PROJECT_NAME}`, {
                    method: 'DELETE'
                });

                if (runnerResponse.ok && projectResponse.ok) {
                    showResult('cleanup-result', `âœ… æ¼”ç¤ºé¡¹ç›® "${PROJECT_NAME}" å·²æ¸…ç†å®Œæˆï¼`);
                } else {
                    showResult('cleanup-result', `âš ï¸ éƒ¨åˆ†æ¸…ç†å¯èƒ½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç®¡ç†é¢æ¿`, true);
                }
            } catch (error) {
                showResult('cleanup-result', `âŒ æ¸…ç†å¤±è´¥: ${error.message}`, true);
            }
        }
    </script>
</body>
</html>