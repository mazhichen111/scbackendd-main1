# Scbackend

ä¸€ä¸ªå°† Scratch ç”¨ä½œåç«¯å¼€å‘è¯­è¨€çš„åˆ›æ–°è½¯ä»¶ã€‚

## âœ¨ æ–°åŠŸèƒ½å’Œä¿®å¤

### ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜
- âœ… ä¿®å¤äº† `dbconfig.json` çš„ JSON è¯­æ³•é”™è¯¯
- âœ… è§£å†³äº† `fetch` API åœ¨ Node.js ä¸­çš„å…¼å®¹æ€§é—®é¢˜
- âœ… å®Œå–„äº†æ•°æ®åº“åˆå§‹åŒ–æµç¨‹
- âœ… å¢å¼ºäº†é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ
- âœ… ä¿®å¤äº†äº‹ä»¶å¤„ç†é€»è¾‘
- âœ… æ”¹è¿›äº† WebSocket è¿æ¥ç®¡ç†

### ğŸ†• æ–°å¢åŠŸèƒ½
- ğŸ¨ å…¨æ–°çš„ç°ä»£åŒ–ç®¡ç†ç•Œé¢
- ğŸ“Š å®æ—¶çŠ¶æ€ç›‘æ§å’Œæ—¥å¿—æ˜¾ç¤º
- ğŸ”„ å®Œæ•´çš„é¡¹ç›® CRUD æ“ä½œ
- âš¡ Runner ç®¡ç†å’Œäº‹ä»¶è§¦å‘
- ğŸ§ª å†…ç½®æ¼”ç¤ºå’Œæµ‹è¯•åŠŸèƒ½
- ğŸ“š å®Œæ•´çš„ API æ–‡æ¡£
- ğŸ”’ å®‰å…¨æ€§æ”¹è¿›å’Œè¾“å…¥éªŒè¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶
- Node.js 16.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- Git

### å®‰è£…å’Œè¿è¡Œ

1. **å…‹éš†é¡¹ç›®**:
   ```bash
   git clone https://github.com/scbackend/scbackendd.git
   cd scbackendd
   ```

2. **å¯åŠ¨æœåŠ¡**:
   ```bash
   npm start
   ```
   
   é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ï¼š
   - æ£€æŸ¥ Node.js ç‰ˆæœ¬
   - å®‰è£…ç¼ºå¤±çš„ä¾èµ–
   - åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶
   - åˆå§‹åŒ–æ•°æ®åº“

3. **è®¿é—®ç®¡ç†ç•Œé¢**:
   - æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:3030
   - æ¼”ç¤ºé¡µé¢: http://localhost:3030/demo.html

### å…¶ä»–å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev

# è¿è¡Œæµ‹è¯•
npm test

# ç›´æ¥å¯åŠ¨ï¼ˆè·³è¿‡æ£€æŸ¥ï¼‰
npm run direct

# è¯­æ³•æ£€æŸ¥
npm run check
```

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### 1. åˆ›å»º Scratch é¡¹ç›®

è®¿é—®ç®¡ç†ç•Œé¢ï¼Œç‚¹å‡»"åˆ›å»ºæ–°é¡¹ç›®"ï¼Œè¾“å…¥ï¼š
- **é¡¹ç›®åç§°**: ä¾‹å¦‚ `hello_world`
- **é¡¹ç›®å†…å®¹**: Scratch é¡¹ç›®çš„ JSON æ•°æ®

### 2. è¿è¡Œé¡¹ç›®

åœ¨é¡¹ç›®åˆ—è¡¨ä¸­ç‚¹å‡»"è¿è¡Œ"æŒ‰é’®ï¼Œæˆ–ä½¿ç”¨ APIï¼š
```bash
curl http://localhost:3030/runner/add/hello_world
```

### 3. è§¦å‘äº‹ä»¶

é€šè¿‡ç®¡ç†ç•Œé¢æˆ– API å‘è¿è¡Œä¸­çš„é¡¹ç›®å‘é€äº‹ä»¶ï¼š
```bash
curl -X POST http://localhost:3030/runner/hello_world/trigger \
  -H "Content-Type: application/json" \
  -d '{"event": "custom_event", "data": {"message": "Hello"}}'
```

## ğŸ“¡ API æ¥å£

### é¡¹ç›®ç®¡ç†
- `GET /projects` - è·å–æ‰€æœ‰é¡¹ç›®
- `GET /project/:id` - è·å–å•ä¸ªé¡¹ç›®
- `POST /create` - åˆ›å»ºé¡¹ç›®
- `PUT /project/:id` - æ›´æ–°é¡¹ç›®
- `DELETE /project/:id` - åˆ é™¤é¡¹ç›®

### Runner ç®¡ç†
- `GET /runners` - è·å–æ‰€æœ‰ Runners
- `GET /runner/add/:id` - æ·»åŠ  Runner
- `GET /runner/remove/:id` - ç§»é™¤ Runner
- `POST /runner/:id/trigger` - è§¦å‘äº‹ä»¶

### WebSocket
- è¿æ¥: `ws://localhost:3031`
- æ”¯æŒå®æ—¶äº‹ä»¶å¹¿æ’­å’ŒåŒå‘é€šä¿¡

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
scbackendd/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js          # ä¸»å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ server.js         # HTTP æœåŠ¡å™¨
â”‚   â”œâ”€â”€ service.js        # WebSocket æœåŠ¡
â”‚   â”œâ”€â”€ manager.js        # Runner ç®¡ç†å™¨
â”‚   â”œâ”€â”€ projects.js       # é¡¹ç›®æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ runner.js         # Scratch VM è¿è¡Œå™¨
â”‚   â”œâ”€â”€ logger.js         # æ—¥å¿—ç³»ç»Ÿ
â”‚   â””â”€â”€ errorHandler.js   # é”™è¯¯å¤„ç†
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html        # ç®¡ç†ç•Œé¢
â”‚   â””â”€â”€ demo.html         # æ¼”ç¤ºé¡µé¢
â”œâ”€â”€ extensions/
â”‚   â””â”€â”€ scbackendbasic.js # Scratch æ‰©å±•
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ API.md           # API æ–‡æ¡£
â”‚   â””â”€â”€ SECURITY.md      # å®‰å…¨è¯´æ˜
â”œâ”€â”€ start.js             # å¯åŠ¨è„šæœ¬
â””â”€â”€ test-server.js       # æµ‹è¯•è„šæœ¬
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

- é»˜è®¤é…ç½®ä»…é€‚ç”¨äºå¼€å‘ç¯å¢ƒ
- ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹æ•°æ®åº“å¯†ç 
- å»ºè®®ä½¿ç”¨é˜²ç«å¢™é™åˆ¶ç«¯å£è®¿é—®
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…ä»¥ä¿®å¤å®‰å…¨æ¼æ´

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**:
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -ano | findstr :3030
   netstat -ano | findstr :3031
   ```

2. **ä¾èµ–å®‰è£…å¤±è´¥**:
   ```bash
   # æ¸…ç†å¹¶é‡æ–°å®‰è£…
   rm -rf node_modules package-lock.json
   npm install
   ```

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**:
   - æ£€æŸ¥ `dbconfig.json` é…ç½®
   - ç¡®ä¿ SQLite æ–‡ä»¶æƒé™æ­£ç¡®
   - MySQL ç”¨æˆ·éœ€è¦æœ‰ç›¸åº”æƒé™

### æ—¥å¿—æŸ¥çœ‹

æœåŠ¡è¿è¡Œæ—¶ä¼šæ˜¾ç¤ºè¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- æœåŠ¡å™¨å¯åŠ¨çŠ¶æ€
- æ•°æ®åº“è¿æ¥çŠ¶æ€
- Runner è¿è¡ŒçŠ¶æ€
- é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯


## ğŸ“„ è®¸å¯è¯

AGPL-3.0-only

---

**ç‰ˆæœ¬**: 1.0.3 
**ç»´æŠ¤è€…**: XQYWorld & yvhong